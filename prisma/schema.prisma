generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

model myTrack {
    id       Int     @id @default(autoincrement())
    track_id String?
    user_id  String?
    track    track?  @relation(fields: [track_id], references: [spotify_id])
    user     user?   @relation(fields: [user_id], references: [id])

    @@index([track_id], map: "myTrack_track_id_fkey")
    @@index([user_id], map: "myTrack_user_id_fkey")
}

model track {
    spotify_id String    @id @unique
    name       String?
    rating     Int?
    artist_id  String?
    album_id   String?
    album      album?    @relation(fields: [album_id], references: [spotify_id])
    artist     artist?   @relation(fields: [artist_id], references: [spotify_id])
    myTracks   myTrack[]
    losers     vote[]    @relation("losers")
    winners    vote[]    @relation("winners")

    @@index([album_id], map: "track_album_id_fkey")
    @@index([artist_id], map: "track_artist_id_fkey")
}

model user {
    id         String    @id @unique @default(cuid())
    email      String?   @unique
    spotify_id String?
    offset     Int?      @default(0)
    myTracks   myTrack[]
    votes      vote[]
}

model vote {
    id                 String  @id @unique @default(cuid())
    winner_id          String
    loser_id           String
    pre_rating_winner  Int?
    pre_rating_loser   Int?
    post_rating_winner Int?
    post_rating_loser  Int?
    user_id            String?
    loser              track   @relation("losers", fields: [loser_id], references: [spotify_id])
    user               user?   @relation(fields: [user_id], references: [id])
    winner             track   @relation("winners", fields: [winner_id], references: [spotify_id])

    @@index([loser_id], map: "vote_loser_id_fkey")
    @@index([user_id], map: "vote_user_id_fkey")
    @@index([winner_id], map: "vote_winner_id_fkey")
}

model album {
    spotify_id   String    @id @unique
    artist       artist?   @relation(fields: [artist_id], references: [spotify_id])
    artist_id    String?
    name         String?
    release_date DateTime?
    tracks       track[]
}

model artist {
    spotify_id String  @id @unique
    name       String?
    tracks     track[]
    album      album[]
}
